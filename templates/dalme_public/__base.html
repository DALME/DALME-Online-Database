{% load static dalme_public_tags wagtailimages_tags wagtailuserbar %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    {% block meta %}
      <meta charset="utf-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
      <meta name="description" content=""/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
    {% endblock %}
    <title>
      {% block title %}DALME{% endblock %}
    </title>
    {% block styles %}
      <link rel="stylesheet" type="text/css" href="{% static 'css/dalme_public.css' %}" />
    {% endblock %}
  </head>

  {% with page.get_verbose_name|lower as page_name %}
    <body id="body" class="{{ page_name }} u-flex u-type-sans">
      {% block banner %}{% endblock %}
      {% image page.header_image original as header_image %}
      <header
        class="{{ page_name }}"
        role="banner"
        {% if header_image %}
          {% get_header_image_styles header_image as styles %}
          style="{{ styles }}"
        {% endif %}>
          {% include "dalme_public/includes/_nav.html" %}
          {% block header_extra %}{% endblock %}
      </header>

      <main
        id="main" class="{{ page_name }}{% if inventories or inventory %} inventories{% endif %}" role="main">
        {% block content %}{% endblock %}
      </main>

      <footer class="u-flex">
        {% include "dalme_public/includes/_footer.html" %}
      </footer>

      {% block js_foot %}
        <script src="https://kit.fontawesome.com/04c8493f39.js" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <script>
          // Subsections initialize.
          const subsections = $('.block-subsection');
          $.each(subsections, function(index, value) {
            const subsection = $(value);
            const nextSubsection = subsection.nextAll('.block-subsection:first');
            if (subsection.find('i').hasClass('fa-caret-left')) {
              nextSubsection.length
                ? subsection.nextUntil(nextSubsection).hide()
                : subsection.nextAll().hide();
            }
          });

          // Collections initialize.
          const collections = $('section.collection');
          $.each(collections, function(index, value) {
            const collection = $(value);
            if (collection.find('i').hasClass('fa-caret-left')) {
              collection.children().not('.u-subsection').hide();
            }
          });

          $('body').on('click', '#handle', function(e) {
            const target = $(e.target);
            target.hasClass('fa-caret-left')
              ? target.removeClass('fa-caret-left').addClass('fa-caret-down')
              : target.removeClass('fa-caret-down').addClass('fa-caret-left');
            target.closest('section').attr('data-collapsed', function(index, attr) {
              return attr === 'true' ? 'false' : 'true';
            });

            // Subsections collapsing logic.
            if (target.hasClass('subsection')) {
              const subsection = $(target).closest('.block-subsection');
              const nextSubsection = subsection.nextAll('.block-subsection:first');
              if (target.hasClass('fa-caret-left')) {
                nextSubsection.length
                  ? subsection.nextUntil(nextSubsection).hide()
                  : subsection.nextAll().hide();
              } else {
                nextSubsection.length
                  ? subsection.nextUntil(nextSubsection).show()
                  : subsection.nextAll().show();
              }
            }

            // Collections collapsing logic.
            if (target.hasClass('collection')) {
              const collection = $(target).closest('section.collection');
              const nodes = collection.children().not('.u-subsection');
              target.hasClass('fa-caret-left')
                ? nodes.hide()
                : nodes.show();
            }
          });
        </script>
      {% endblock %}
    </body>
  {% endwith %}

  {% wagtailuserbar 'bottom-right' %}
</html>
