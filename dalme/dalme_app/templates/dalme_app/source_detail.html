{% extends "dash_base.html" %}
{% load staticfiles i18n %}

{% block extra_head %}
  <link href="{% static '/css/chosen.css' %}" rel="stylesheet">
  <script type="text/javascript" src="{% static 'js/xonomy.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/xonomy_tei_docspecs.js' %}"></script>
  <link type="text/css" rel="stylesheet" href="{% static 'css/xonomy.css' %}"/>

  <!--TEMPORARY HACK: toggle button script for Xonomy mode-->
  <script type="text/javascript">
    function changeMode(buttonID) {
      if (buttonID == "btnModeRead") {
        document.getElementById(buttonID).className = "btn btn-primary";
        document.getElementById("btnModeQuick").className = "btn btn-default";
        document.getElementById("btnModeFull").className = "btn btn-default";
        start(easy_read);
      };
      if (buttonID == "btnModeQuick") {
        document.getElementById(buttonID).className = "btn btn-primary";
        document.getElementById("btnModeRead").className = "btn btn-default";
        document.getElementById("btnModeFull").className = "btn btn-default";
        start(quick_edit);
      };
      if (buttonID == "btnModeFull") {
        document.getElementById(buttonID).className = "btn btn-primary";
        document.getElementById("btnModeQuick").className = "btn btn-default";
        document.getElementById("btnModeRead").className = "btn btn-default";
        start(full_edit);
      };
    }
  </script>

  {% if source_has_pages %}
    <link href="{% static 'ImageViewer/imageviewer.css' %}" rel="stylesheet" type="text/css" />
    <script src="{% static 'ImageViewer/imageviewer.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/mirador-combined.css' %}"/>
    <script src="{% static 'js/mirador.min.js' %}"></script>

    <style media="screen">
      #viewer {
        height: 1000px;
        width: 100%;
      }
    </style>
  {% endif %}
{% endblock %}

{% block extra_dropdowns %}{% endblock %}

{% block content %}

<div id="page-wrapper">
  <div class="row">
    <div class="col-lg-12">
      <h1 class="page-header">Source Detail</h1>
    </div>
  </div>
  <div class="row">
      <div class="col-lg-12">
            <ul class="nav nav-tabs">
              <li class="active"><a href="#document" data-toggle="tab">Document Viewer</a>
              </li>
              <li><a href="#transcription" data-toggle="tab">Transcription</a>
              </li>
              <li><a href="#metadata" data-toggle="tab">Metadata</a>
              </li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content">
                <div class="tab-pane fade in active" id="document">
                  {% if source.page_set.all %}
                  <div class="panel-body">
                    <div class="row">
                      <div class="col-lg-12 nopadding">
                        <div id="viewer"></div>
                        <script type="text/javascript">
                          $(function() {
                            Mirador({
                              id: "viewer",
                              data: [
                                { manifestUri: "{{ request.build_absolute_uri }}/manifest" },
                                { manifestUri: "https://dam.dalme.org/iiif/8145/manifest" },
                              ],
                              windowObjects: [
                                {
                                  loadedManifest: "{{ request.build_absolute_uri }}/manifest",
                                  viewType: "ImageView"
                                }
                              ]
                            });
                          });
                        </script>
                      </div>
                    </div>
                  </div>
                  {% endif %}
                </div>
                <div class="tab-pane fade" id="transcription">
                  <div class="panel-body">
                    <div class="row">
                      <div class="col-lg-12 nopadding">
                        <div class="panel panel-default">
                          <div class="panel-heading text-right">
                            Mode:
                            <button type="button" id="btnModeRead" class="btn btn-primary" onclick="changeMode(this.id);">Easy Read</button>
                            <button type="button" id="btnModeQuick" class="btn btn-default" onclick="changeMode(this.id);">Quick Edit</button>
                            <button type="button" id="btnModeFull" class="btn btn-default" onclick="changeMode(this.id);">Full TEI</button>
                          </div>
                          <div class="panel-body">
                            <div id="editor"></div>
                            <script type="text/javascript">
                              function start(mode) {
                                  var spec = mode;
                                  var xml='{{ transcription|safe }}';
                                  var editor=document.getElementById("editor");
                                  Xonomy.render(xml, editor, spec);
                                  }
                              start(easy_read);
                            </script>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="tab-pane fade" id="metadata">
                  <div class="panel-body">
                  <div class="row">
                    <div class="col-lg-4">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          <i class="fa fa-list-alt fa-fw"></i> Metadata
                        </div>
                        <div class="panel-body">
                          <p><strong>Name: </strong>{{ source.name }}</p>
                          <p><strong>Type: </strong>{{ source.type.name }}</p>
                          <p><strong>Short name: </strong>{{ source.short_name }}</p>
                          {% if source.parent_source %}
                          <p><strong>Parent source: </strong><a href="{% url 'source_detail' source.parent_source.pk %}">{{ source.parent_source.name }}</a></p>
                          {% endif %}
                          <p><strong>Is inventory: </strong>{{ source.is_inventory }}</p>
                          <a href="#source-detail-modals" data-toggle="modal" data-target="#source-detail-modals" class="btn btn-primary">Update source</a>
                        </div>
                      </div>
                    </div>
                    {% if source_has_children %}
                    <div class="col-lg-4">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          Children
                        </div>
                        <div class="panel-body">
                          <ul>
                            {% for child in children %}
                            <li><a href="{% url 'source_detail' child.pk %}">{{ child.name }}</a></li>
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                    </div>
                    {% endif %}
                    {% if source.get_attributes %}
                    <div class="col-lg-4">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          Attributes
                        </div>
                        <div class="panel-body">
                          {% for attribute_type, attributes in source.get_attributes.items %}
                          <p><strong>{{ attribute_type }}: </strong>{{ attributes }}</p>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                    {% endif %}
                    {% if source.page_set.all %}
                    <div class="col-lg-4">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          Pages
                        </div>
                        <div class="panel-body">
                          {% for page in source.page_set.all %}
                            <p><a href="{% url 'page_detail' page.pk %}">{{ page }}</a></p>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                    {% endif %}
                  </div>
                </div>
                </div>
            </div>

    <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="source-detail-update-title" aria-hidden="true" id="source-detail-modals">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="source-detail-update-title">Update {{ source }}</h4>
          </div>
          <div class="modal-body">
            <form method="post" id="source-detail-update-form" enctype="multipart/form-data">
              {% csrf_token %}
              {{ form.as_p }}
              <input type="submit" value="Update"/>
            </form>
          </div>
        </div>
      </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/chosen.jquery.js' %}" charset="utf-8"></script>
<script type="text/javascript">
  $(".chosen-select").chosen({width:"100%"});
</script>
<script src="{% static 'vendor/metisMenu/metisMenu.min.js' %}"></script>

{% endblock %}
