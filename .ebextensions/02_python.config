container_commands:
  01_installpycurl:
    command: source /opt/python/run/venv/bin/activate && export CPPFLAGS=-I/usr/local/opt/openssl/include && export LDFLAGS=-L/usr/local/opt/openssl/lib && pip install pycurl --global-option='--with-openssl'
  02_collectstatic:
    command: source /opt/python/run/venv/bin/activate && python manage.py collectstatic --noinput
  03_compress_and_recollect:
    command: python manage.py compress --verbosity=0 && python manage.py collectstatic --noinput
  04_set_logfile_permissions and owner:
    command: chmod a+w /opt/python/log/dalme_app.log && chown root:wsgi /opt/python/log/dalme_app.log
  05_mkdir_for_djangoq_log_and_pid:
    command: "mkdir -p /var/log/djangoq/ /var/run/djangoq/"
  06_djangoq_configure:
    command: "cp .ebextensions/django_q_cluster.sh /opt/elasticbeanstalk/hooks/appdeploy/post/ && chmod 744 /opt/elasticbeanstalk/hooks/appdeploy/post/django_q_cluster.sh"
    cwd: "/opt/python/ondeck/app"
  07_djangoq_run:
    command: "/opt/elasticbeanstalk/hooks/appdeploy/post/django_q_cluster.sh"
option_settings:
  "aws:elasticbeanstalk:application:environment":
    PYTHONPATH: "/opt/python/current/app:$PYTHONPATH"
