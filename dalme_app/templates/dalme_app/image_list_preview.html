{% extends "base.html" %}
{% load staticfiles i18n %}
{% block extra_head %}
{% if form_helper %}
<script type="text/javascript" src="{% static 'dalme_form_helpers/' %}{{ form_helper }}"></script>
{% endif %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/scroller/2.0.0/css/scroller.bootstrap4.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/scroller/2.0.0/js/dataTables.scroller.min.js"></script>
<link href="{% static 'jquery-ui-resizable/jquery-ui.min.css' %}" rel="stylesheet">
<script type="text/javascript" src="{% static 'jquery-ui-resizable/jquery-ui.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/dalme_datatables.js' %}"></script>
<script type="text/javascript" src="{% static 'js/dalme_list_preview.js' %}"></script>

<script type="text/javascript">
    {% if dt_editor %}
      var dt_editor_options = {
        'ajax': {
          'create': {
              'type': 'POST',
              'url': '{{ dt_editor.ajax_url }}',
              'headers': {'X-CSRFToken': getCookie("csrftoken") },
              'data': function (data) { return { "data": JSON.stringify( data ) }; }
            },
          'edit': {
              'type': 'PUT',
              'url': '{{ dt_editor.ajax_url }}_id_/',
              'headers': {'X-CSRFToken': getCookie("csrftoken") },
              'data': function (data) { return { "data": JSON.stringify( data ) }; }
            },
          'remove': {
              'type': 'DELETE',
              'url': '{{ dt_editor.ajax_url }}_id_/',
              'headers': {'X-CSRFToken': getCookie("csrftoken") },
              'data': function (data) { return { "data": JSON.stringify( data ) }; }
            }
          },
          {% for k,v in dt_editor.options.items %}
            {{ k }}:{{ v | safe }},
          {% endfor %}
          fields: [
            {% for i in dt_editor.fields %}
              {
                {% for k,v in i.items %}
                  {% if k == 'opts' %}
                    opts: {
                      {% for ok, ov in v.items %}
                        {{ ok | safe }}: "{{ ov | safe }}",
                      {% endfor %}
                    },
                  {% elif k == 'options' %}
                    options: [
                      {% for o in v %}
                        {
                          {% for l,p in o.items %}
                            {{ l | safe }}: "{{ p | escapejs }}",
                          {% endfor %}
                        },
                      {% endfor %}
                    ],
                  {% else %}
                    {{ k | safe }}: "{{ v | safe }}",
                  {% endif %}
                {% endfor %}
              },
            {% endfor %}
          ]};
    {% endif %}

    {% if dt_editor.buttons %}
      var dt_editor_buttons = {{ dt_editor.buttons | safe }};
    {% endif %}

    var dt_options = {
      {% for k,v in dt_options.options.items %}
        {% if k == 'ajax' %}
          'ajax': {
            'url': {{ v | safe }},
            'data': function (data) { return { "data": JSON.stringify( data ) }; }
          },
        {% else %}
          {{ k }}:{{ v | safe }},
        {% endif %}
      {% endfor %}
        buttons:[
          {% for dict in dt_options.buttons %}
            {
              {% for k,v in dict.items %}
                {{ k }}:{{ v | safe }},
              {% endfor %}
            },
          {% endfor %}
          {% if dt_options.buttons_extra %}
            {% for b in dt_options.buttons_extra %}
              {{ b | safe }},
            {% endfor %}
          {% endif %}
          ],
          columnDefs:[
            {% for dict in dt_options.columnDefs %}
              {
                {% for k,v in dict.items %}
                  {{ k }}:{{ v | safe }},
                {% endfor %}
              },
            {% endfor %}
          ]};
    $(document).ready( function () {
      createDatatable('#dataTables-list', "{{ form_helper }}");
      // startPreview();
    });
    {% if filters %}
      var filters = {{ filters | safe }};
      $(document).on('init.dt', function () {
        addDtToolbarButton('filters');
        addDtToolbarButton('preview');
      });
    {% endif %}
</script>
{% endblock %}

{% block extra_dropdowns %}{% endblock %}

{% block content %}
<!-- Begin Page Content -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="card shadow mb-4">
          <div class="table-responsive">
            <table class="table table-hover table-border responsive" id="dataTables-list" width="100%">
            </table>
          </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_scripts %}
{% endblock %}
